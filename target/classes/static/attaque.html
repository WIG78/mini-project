<!DOCTYPE html>
<html>
<head>
    <!--Import Google Icon Font-->
    <link href="http://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!--Import materialize.css-->
    <link type="text/css" rel="stylesheet" href="css/materialize.min.css"  media="screen,projection"/>

    <!--Let browser know website is optimized for mobile-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0" charset="utf-8"/>
    <script src="cookies.js"></script>
</head>

<body>
<div class="container">
    <nav>
        <div class="nav-wrapper light-blue darken-2">
            <a href="#" class="brand-logo center"> mini-project</a>
            <ul id="nav-mobile" class="left hide-on-med-and-down">
                <li><a href="index.html">Home</a></li>
                <li id="chooseCharacter"><a>Choisir un personnage</a></li>
                <li id="character"><a id="linkCharacter"></a></li>
            </ul>
        </div>
    </nav>
</div>

<div class="container">
    <div class="row center-align">
        <div class="col s3">
            <h5 class="center">Actions</h5>
            <div id="menu_action" hidden class="row">
                <ul>
                    <li id="nextFoe" hidden><a class="waves-effect waves-light btn light-blue darken-2">Prochain adversaire</a></li>
                </ul>
            </div>
        </div>
        <div class="col s6">
            <div id="includedContent">
                <div id="form">
                    <label for="dammage">Puissance de l'attaque</label>
                    <input type="number" id="dammage" name="dammage">
                    <button id="attaquer" class="btn waves-effect waves-light light-blue darken-2" type="submit">Attaquer </button>
                </div>
                <p id="information"></p>
                <p id="KO"></p>
            </div>
        </div>
    </div>
</div>

<div class="container">
    <footer class="page-footer light-blue darken-2">
        <div class="footer-copyright">
            <div class="container">
                © 2021 Copyright
            </div>
        </div>
    </footer>
</div>
<!--Import jQuery before materialize.js-->
<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
<script type="text/javascript" src="js/materialize.min.js"></script>
<script>

    attaquer.onclick = function() {
        var xhr = new XMLHttpRequest();
        xhr.open('POST', '/attack', true);
        xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
        xhr.onload = function() {
            if (xhr.status === 200) {
                console.log("onload");
                document.getElementById("information").innerHTML = xhr.responseText;
                console.log(xhr.responseText);
            }
            else {
                alert('Request failed. Returned status of ' + xhr.status);
            }
        };
        xhr.send("dammage=" + document.getElementById("dammage").value);
        console.log('fin fonction');
    }

    if(document.cookie.indexOf('name=') != -1 && findValueCookie('name') != "")
    {
        document.getElementById("linkCharacter").innerHTML = findValueCookie('name');
    }

    if(document.cookie.indexOf('HP=') != -1 && findValueCookie('HP') != "")
    {
         if(findValueCookie('HP') <= 0)
         {
            document.getElementById("form").hidden = true;
            document.getElementById("KO").innerHTML = "Vous êtes KO ! Vous avez battu : " + findValueCookie('foeNumber') + " adversaire(s).";
         }
    }

    if(document.cookie.indexOf('foeHP=') != -1 && findValueCookie('foeHP') != "")
    {
         if(findValueCookie('foeHP') <= 0)
         {
            document.getElementById("form").hidden = true;
            document.getElementById("nextFoe").hidden = false;
         }
    }

    character.onclick = function() {
      $("#includedContent").load("characterBloc.html");
    }

    chooseCharacter.onclick = function() {
      $("#includedContent").load("chooseCharacter.html");
    }

</script>
</body>
</html>